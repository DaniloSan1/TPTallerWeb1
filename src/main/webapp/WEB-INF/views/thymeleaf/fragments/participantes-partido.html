<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head> </head>
    <body
        th:fragment="participantes-partido (idPartido, participantes, equipo, equipos, showDropdown)"
    >
        <div
            class="d-flex flex-row align-items-center justify-content-between gap-2"
            style="border-bottom: 1px solid black; min-height: 100px"
        >
            <img
                th:src="${equipo.insigniaUrl != null ? equipo.insigniaUrl : 'https://taller-web-1-416711641372-us-east-2.s3.us-east-2.amazonaws.com/insignia-default.png'}"
                alt="Insignia del equipo"
                class="img-fluid"
                style="max-height: 4rem; max-width: 4rem; object-fit: contain"
            />
            <h4 class="mt-2 flex-grow-1" th:text="${equipo.nombre}"></h4>
            <a
                class="btn btn-sm btn-outline-primary ms-2"
                th:if="${showDropdown}"
                th:href="@{/equipos/{id}/editar(id=${equipo.idEquipo})}"
                >Editar</a
            >
            <h4
                class="d-flex align-items-center justify-content-center mt-2"
                style="
                    width: 32px;
                    color: white;
                    background-color: var(--primary-color);
                    border-bottom: 1px solid black;
                "
                th:text="${equipo.goles}"
            ></h4>
        </div>
        <div class="alert alert-info" th:if="${#lists.isEmpty(participantes)}">
            No hay jugadores en este equipo aún
        </div>
        <div
            th:if="${!#lists.isEmpty(participantes)}"
            id="listado-participantes"
            class="list-group"
        >
            <div
                class="position-relative participante-item"
                th:each="participante : ${participantes}"
            >
                <div
                    th:replace="~{fragments/jugador-simple :: jugador-simple (jugador=${participante})}"
                ></div>
                <!-- Dropdown -->
                <div
                    class="dropdown position-absolute"
                    style="top: 2px !important; right: 2px !important"
                >
                    <button
                        class="btn btn-light dropdown-toggle"
                        type="button"
                        id="dropdownMenuButton1"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                    ></button>
                    <ul
                        class="dropdown-menu"
                        aria-labelledby="dropdownMenuButton1"
                    >
                        <li>
                            <a
                                class="dropdown-item"
                                id="ver-perfil"
                                th:href="@{/perfil/ver/username/} + ${participante.username}"
                                >Ver Perfil</a
                            >
                        </li>
                        <li>
                            <a
                                class="dropdown-item"
                                data-bs-toggle="modal"
                                th:if="${showDropdown}"
                                data-bs-target="#actualizarEquipo"
                                th:data-bs-nombre="${participante.nombreCompleto}"
                                th:data-bs-equipo="${participante.idEquipo}"
                                th:data-bs-id="${participante.id}"
                                >Asignar Equipo</a
                            >
                        </li>
                        <li>
                            <a
                                class="dropdown-item"
                                data-bs-toggle="modal"
                                th:if="${showDropdown}"
                                data-bs-target="#promoverCapitanModal"
                                th:data-bs-nombre="${participante.nombreCompleto}"
                                th:data-bs-id="${participante.id}"
                                >Promover a capitán</a
                            >
                        </li>
                        <li>
                            <a
                                class="dropdown-item"
                                data-bs-toggle="modal"
                                data-bs-target="#modalCalificar"
                                th:data-bs-id="${participante.idUsuario}"
                                th:data-bs-nombre="${participante.nombreCompleto}"
                                th:data-bs-partido-id="${idPartido}"
                            >
                                Calificar jugador ⭐
                            </a>
                        </li>
                        <div
                            th:if="${showDropdown}"
                            class="dropdown-divider"
                        ></div>
                        <li>
                            <a
                                class="dropdown-item text-danger"
                                data-bs-toggle="modal"
                                th:if="${showDropdown}"
                                data-bs-target="#eliminarParticipante"
                                th:data-bs-nombre="${participante.nombreCompleto}"
                                th:data-bs-id="${participante.id}"
                                >Eliminar</a
                            >
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Modal Asignar Equipo -->
        <div
            class="modal fade"
            id="actualizarEquipo"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
            tabindex="-1"
            aria-labelledby="actualizarEquipoLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form id="form-asignar-equipo" method="post">
                        <input
                            type="hidden"
                            id="participante-id"
                            name="participanteId"
                        />
                        <div class="modal-header">
                            <h1
                                class="modal-title fs-5"
                                id="actualizarEquipoLabel"
                            >
                                Asignar Equipo
                            </h1>
                        </div>
                        <div class="modal-body">
                            <select
                                class="form-select"
                                id="equipo-select"
                                name="equipo"
                                aria-label="Selecciona un equipo"
                            >
                                <option
                                    th:each="equipo : ${equipos}"
                                    th:value="${equipo.idEquipo}"
                                    th:text="${equipo.nombre}"
                                ></option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                            >
                                Cerrar
                            </button>
                            <button
                                type="submit"
                                class="btn btn-primary"
                                id="btn-asignar"
                            >
                                Asignar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Eliminar Participante -->
        <div
            class="modal fade"
            id="eliminarParticipante"
            data-bs-keyboard="false"
            tabindex="-1"
            aria-labelledby="eliminarParticipanteLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form id="form-eliminar-participante" method="POST">
                        <input
                            type="hidden"
                            id="participante-a-eliminar-id"
                            name="participanteAEliminarId"
                        />
                        <div class="modal-header">
                            <h1
                                class="modal-title fs-5 text-danger"
                                id="eliminarParticipanteLabel"
                            >
                                Eliminar Participante
                            </h1>
                        </div>
                        <div class="modal-body">
                            <p id="mensaje-eliminar-participante">
                                &iquest;Est&aacute;s seguro que deseas eliminar
                                a este participante del partido?
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                            >
                                Cancelar
                            </button>
                            <button
                                type="submit"
                                class="btn btn-danger"
                                id="btn-eliminar"
                            >
                                Aceptar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal fade" id="modalCalificar" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form id="form-calificar-jugador" method="post">
                        <input
                            type="hidden"
                            id="jugador-calificar-id"
                            name="jugadorId"
                        />

                        <div class="modal-header">
                            <h5 class="modal-title">Calificar jugador</h5>
                        </div>
                        <div class="modal-body">
                                <label class="form-label fw-bold">Calificación:</label>
                                <div class="star-rating mb-2">
                                    <input type="radio" id="star5_modal" name="puntuacion" value="5" required />
                                    <label for="star5_modal" title="5 estrellas">&#9733;</label>

                                    <input type="radio" id="star4_modal" name="puntuacion" value="4" />
                                    <label for="star4_modal" title="4 estrellas">&#9733;</label>

                                    <input type="radio" id="star3_modal" name="puntuacion" value="3" />
                                    <label for="star3_modal" title="3 estrellas">&#9733;</label>

                                    <input type="radio" id="star2_modal" name="puntuacion" value="2" />
                                    <label for="star2_modal" title="2 estrellas">&#9733;</label>

                                    <input type="radio" id="star1_modal" name="puntuacion" value="1" />
                                    <label for="star1_modal" title="1 estrella">&#9733;</label>
                                </div>
                            <div class="mb-3">
                                <label class="form-label">Comentario (opcional)</label>
                                <input type="text" name="comentario" class="form-control" />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                            >
                                Cancelar
                            </button>
                            <button type="submit" class="btn btn-success">
                                Enviar calificación
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <style>
            .star-rating {
                direction: rtl;
                display: inline-flex;
                font-size: 1.6rem;
                cursor: pointer;
            }
            .star-rating input {
                display: none;
            }
            .star-rating label {
                color: lightgray;
                padding: 0 0.1rem;
            }
            .star-rating input:checked ~ label {
                color: gold;
            }
            .star-rating label:hover,
            .star-rating label:hover ~ label {
                color: gold;
            }
        </style>

        <!-- Modal Promover Capitán -->
        <div
            class="modal fade"
            id="promoverCapitanModal"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
            tabindex="-1"
            aria-labelledby="promoverCapitanLabel"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form id="form-promover-capitan" method="POST">
                        <input
                            type="hidden"
                            id="participante-a-promover-id"
                            name="participanteAPromoverId"
                        />
                        <div class="modal-header">
                            <h1
                                class="modal-title fs-5"
                                id="promoverCapitanLabel"
                            >
                                Promover a Capitán
                            </h1>
                        </div>
                        <div class="modal-body">
                            <p id="mensaje-promover-capitan">
                                ¿Estás seguro que deseas promover a este jugador
                                a capitán? Esto removerá al capitán actual si
                                existe.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                            >
                                Cancelar
                            </button>
                            <button
                                type="button"
                                class="btn btn-primary"
                                id="btn-promover-capitan"
                            >
                                Confirmar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
